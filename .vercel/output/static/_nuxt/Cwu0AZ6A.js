import{_ as M}from"./D0TfP2D2.js";import{_ as S}from"./Cs1SCnFX.js";import{d as N,g as m,b as j,o,w as y,C as c,M as t,i as p,f as s,j as g,F as B,E as $,U as I,J as h,_ as P,D as H}from"./CTkq0g8j.js";import{_ as O}from"./DsTXvJJt.js";import{_ as V}from"./DlAUqK2U.js";const z={class:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},W={class:"text-sm text-muted"},Y={key:0,class:"flex flex-col items-start sm:items-end gap-0.5"},A={key:0,class:"flex items-center justify-center h-80"},J={class:"text-center"},X={key:1,class:"space-y-6"},Z={key:0,class:"grid gap-3 sm:grid-cols-2"},q={class:"h-80 w-full"},G={class:"w-full h-80 flex items-center justify-center"},K={width:"100%",height:"100%",viewBox:"0 0 800 320",class:"border border-gray-200 dark:border-gray-700 rounded-xl bg-white/60 dark:bg-gray-900/40"},Q={key:0,transform:"translate(60, 20)"},R=["d","fill"],T=["points","stroke"],tt=["y1","y2"],et=["cx","cy","fill","title"],at={class:"text-[11px] fill-gray-500 dark:fill-gray-400"},st={x:"50",y:"25","text-anchor":"end"},nt={x:"50",y:"165","text-anchor":"end"},lt={x:"50",y:"305","text-anchor":"end"},ot={class:"text-[11px] fill-gray-500 dark:fill-gray-400"},rt={key:0,x:"80",y:"315","text-anchor":"start"},ct={key:1,x:"720",y:"315","text-anchor":"end"},it={class:"flex items-center justify-center h-80"},dt={key:2,class:"flex items-center justify-center h-80"},mt={class:"text-center"},x=680,ht=280,ut=240,ft=N({__name:"CashFlowChart.client",props:{data:{},loading:{type:Boolean}},setup(F){const i=F,n=m(()=>{const a=i.data?.forecast?.length?i.data.forecast:i.data?.dailyForecast?.length?i.data.dailyForecast:[];return a.length?a.map((e,r)=>({...e,index:r,dateFormatted:new Date(e.date).toLocaleDateString("en-US",{month:"short",day:"numeric"}),isShortfall:e.balance<0,isWarning:e.balance<1e4&&e.balance>0})):[]}),u=a=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0}).format(a),b=m(()=>Math.max(1,n.value.length-1)),w=m(()=>{if(!n.value.length)return{min:0,max:1};const a=n.value.map(d=>d.balance),e=Math.max(...a,0),r=Math.min(...a,0);if(e===r){const d=e===0?1:Math.abs(e)*.1||1;return{min:r-d,max:e+d}}return{min:r,max:e}}),f=a=>{const{min:e,max:r}=w.value,d=r-e||1;return ht-(a-e)/d*ut},v=m(()=>f(0)),D=m(()=>{if(n.value.length===0)return"";const a=f(Math.min(w.value.min,0)),e=n.value.map((r,d)=>`L${d/b.value*x},${f(r.balance)}`);return`M0,${a} ${e.join(" ")} L${x},${a} Z`}),k=m(()=>{const{min:a,max:e}=w.value;return{top:e,mid:e-(e-a)/2,bottom:a}}),C=m(()=>{if(!i.data||!n.value.length)return[];const a=[];return i.data.shortfallDates.length>0&&a.push({type:"critical",icon:"i-lucide-alert-triangle",message:`Cash shortfall predicted in ${i.data.shortfallDates.length} period${i.data.shortfallDates.length>1?"s":""}`}),i.data.projectedEndBalance<i.data.currentCash*.5&&a.push({type:"warning",icon:"i-lucide-trending-down",message:"Cash position expected to decline significantly"}),i.data.minProjectedBalance<5e3&&a.push({type:"warning",icon:"i-lucide-alert-circle",message:"Minimum projected balance below safety threshold"}),a});return(a,e)=>{const r=M,d=S,U=I,E=P,L=O;return o(),j(L,{class:"h-full"},{header:y(()=>[t("div",z,[t("div",null,[e[0]||(e[0]=t("h3",{class:"text-lg font-semibold"},"Cash Flow Forecast",-1)),t("p",W,h(a.data?`${a.data.forecastPeriod}-day projection`:"Loading forecast..."),1)]),!a.loading&&a.data?(o(),c("div",Y,[e[1]||(e[1]=t("span",{class:"text-xs uppercase tracking-wide text-muted"},"Projected End Balance",-1)),t("span",{class:H([{"text-red-600":a.data.projectedEndBalance<0,"text-amber-600":a.data.projectedEndBalance>0&&a.data.projectedEndBalance<1e4,"text-emerald-600":a.data.projectedEndBalance>=1e4},"text-xl font-semibold"])},h(u(a.data.projectedEndBalance)),3)])):g("",!0)])]),default:y(()=>[a.loading?(o(),c("div",A,[t("div",J,[p(r,{class:"h-64 w-full mb-4"}),p(r,{class:"h-4 w-48 mx-auto"})])])):s(n).length>0?(o(),c("div",X,[s(C).length>0?(o(),c("div",Z,[(o(!0),c(B,null,$(s(C),l=>(o(),j(d,{key:l.message,icon:l.icon,color:l.type==="critical"?"red":"amber",variant:"subtle",description:l.message,class:"text-sm"},null,8,["icon","color","description"]))),128))])):g("",!0),t("div",q,[p(U,null,{fallback:y(()=>[t("div",it,[p(r,{class:"h-full w-full"})])]),default:y(()=>[t("div",G,[(o(),c("svg",K,[e[2]||(e[2]=t("defs",null,[t("pattern",{id:"cashflow-grid",width:"80",height:"32",patternUnits:"userSpaceOnUse"},[t("path",{d:"M 80 0 L 0 0 0 32",fill:"none",stroke:"#e5e7eb","stroke-width":"1",opacity:"0.3"})])],-1)),e[3]||(e[3]=t("rect",{width:"100%",height:"100%",fill:"url(#cashflow-grid)"},null,-1)),s(n).length>0?(o(),c("g",Q,[t("path",{d:s(D),fill:s(n).some(l=>l.balance<0)?"rgba(239, 68, 68, 0.1)":"rgba(59, 130, 246, 0.1)",class:"transition-all duration-300"},null,8,R),t("polyline",{points:s(n).map((l,_)=>`${_/s(b)*x},${f(l.balance)}`).join(" "),fill:"none",stroke:s(n).some(l=>l.balance<0)?"#ef4444":"#3b82f6","stroke-width":"3",class:"transition-all duration-300"},null,8,T),t("line",{x1:"0",y1:s(v),x2:x,y2:s(v),stroke:"#6b7280","stroke-width":"1","stroke-dasharray":"4,4",opacity:"0.5"},null,8,tt),t("g",null,[(o(!0),c(B,null,$(s(n),(l,_)=>(o(),c("circle",{key:_,cx:_/s(b)*x,cy:f(l.balance),r:"4",fill:l.balance<0?"#ef4444":l.balance<1e4?"#f59e0b":"#3b82f6",stroke:"white","stroke-width":"2",class:"cursor-pointer hover:r-6 transition-all",title:`${l.dateFormatted}: ${u(l.balance)}`},null,8,et))),128))])])):g("",!0),t("g",at,[t("text",st,h(u(s(k).top)),1),t("text",nt,h(u(s(k).mid)),1),t("text",lt,h(u(s(k).bottom)),1)]),t("g",ot,[s(n).length>0?(o(),c("text",rt,h(s(n)[0]?.dateFormatted),1)):g("",!0),s(n).length>1?(o(),c("text",ct,h(s(n)[s(n).length-1]?.dateFormatted),1)):g("",!0)])]))])]),_:1})]),e[4]||(e[4]=t("div",{class:"flex flex-wrap items-center gap-4 text-xs text-muted"},[t("div",{class:"flex items-center gap-2"},[t("span",{class:"block h-2 w-2 rounded-full bg-blue-500"}),t("span",null,"Healthy Balance")]),t("div",{class:"flex items-center gap-2"},[t("span",{class:"block h-2 w-2 rounded-full bg-amber-500"}),t("span",null,"Low Balance")]),t("div",{class:"flex items-center gap-2"},[t("span",{class:"block h-2 w-2 rounded-full bg-red-500"}),t("span",null,"Critical/Negative")])],-1))])):(o(),c("div",dt,[t("div",mt,[p(E,{name:"i-lucide-trending-up",class:"h-12 w-12 text-muted/50 mx-auto mb-4"}),e[5]||(e[5]=t("p",{class:"text-muted"},"No cash flow data available",-1)),e[6]||(e[6]=t("p",{class:"text-sm text-muted/70"},"Connect to Xero to see your cash flow forecast",-1))])]))]),_:1})}}}),bt=Object.assign(V(ft,[["__scopeId","data-v-5a183785"]]),{__name:"DashboardCashFlowChart"});export{bt as default};
